<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setup UKB project on Rosalind • ukbkings</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Setup UKB project on Rosalind">
<meta property="og:description" content="ukbkings">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ukbkings</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/kcl-ukb-access.html">Access UKB data on Rosalind</a>
    </li>
    <li>
      <a href="../articles/kcl-ukb-setup.html">Setup UKB project on Rosalind</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kenhanscombe/ukbkings/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setup UKB project on Rosalind</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kenhanscombe/ukbkings/blob/master/vignettes/kcl-ukb-setup.Rmd"><code>vignettes/kcl-ukb-setup.Rmd</code></a></small>
      <div class="hidden name"><code>kcl-ukb-setup.Rmd</code></div>

    </div>

    
    
<hr>
<p><strong>Note. This document describes the setup of a UKB project on Rosalind for access with ukbkings.</strong></p>
<hr>
<div id="setup-a-project-directory" class="section level4">
<h4 class="hasAnchor">
<a href="#setup-a-project-directory" class="anchor"></a>Setup a project directory</h4>
<p>Navigate to /scratch/datasets/ukbiobank, create a project directory usb&lt;<em>project_id</em>&gt;_&lt;<em>owner_name</em>&gt;, download and run <code>project.py</code>. This script will create the project directory structure in <strong>Figure 1</strong>, collect the data munging codebase, and download the required UKB programs and utilites. Files used by the data munging pipeline are stored in resources/ (UKB utilites: Codings_Showcase.csv, encoding.ukb, ukbunpack, ukbconv), src/ (munge_ukb.py, cluster.json), and log/.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="bu">cd</span> /scratch/datasets/ukbiobank</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="fu">mkdir</span> ukb_<span class="op">&lt;</span>project_id<span class="op">&gt;</span>_<span class="op">&lt;</span>owner_name<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="bu">cd</span> ukb_<span class="op">&lt;</span>project_id<span class="op">&gt;</span>_<span class="op">&lt;</span>owner_name<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="fu">wget</span> https://raw.githubusercontent.com/kenhanscombe/ukbkings/master/project.py</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="fu">chmod</span> +x project.py</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co"># Load Rosalind default python3 module</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="ex">module</span> load devtools/anaconda/2019.3-python3.7.3</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="ex">./project.py</span></a></code></pre></div>
<p><br></p>
<p style="font-family:menlo; color:white; font-size:85%">
<span style="color:dodgerblue;">/scratch/datasets/ukbiobank/</span><br>
||– <span style="color:dodgerblue">ukb&lt;<em>project_id</em>&gt;_&lt;<em>owner_name</em>&gt;/</span><br>
|| ||– <span style="color:dodgerblue;">raw/</span><br>
|| ||– <span style="color:dodgerblue;">resources/</span><br>
|| ||– <span style="color:dodgerblue;">log/</span><br>
|| ||– <span style="color:dodgerblue;">src/</span><br>
|| ||– <span style="color:dodgerblue;">genotyped/</span><br>
|| ||– <span style="color:dodgerblue;">imputed/</span><br>
|| ||– <span style="color:dodgerblue;">phenotypes/</span><br>
|| ||– <span style="color:limegreen;">project.py</span><br>
|| ||– <span style="color:limegreen;">link.py</span><br>
|| ||– <span style="color:limegreen;">snake.py</span><br>
|| ||– <span style="color:dimgrey;">Snakefile</span>
</p>
<p><strong>Figure 1</strong> Project directory structure after running project.py</p>
<p><br></p>
</div>
<div id="include-project-data" class="section level4">
<h4 class="hasAnchor">
<a href="#include-project-data" class="anchor"></a>Include project data</h4>
<p>The UKB project encrypted files (*.enc) and associated key files (*.key), and withdrawal files (w&lt;<em>project-id</em>&gt;_&lt;<em>yyyymmdd</em>&gt;.csv) must be copied into the subdirectory raw/. Change the key file names to match the encrypted files: ukb&lt;<em>project_id</em>&gt;.enc pairs with ukb&lt;<em>project_id</em>&gt;.key. The first line in each key file should be the project id; the second line should be the decryption key.</p>
<p>Use the UKB program ukgene to download project-specific sample information files (.fam and .sample) and relatedness file (<em>rel</em>.dat/.txt) into raw/. If the key file for your genetic data is k&lt;<em>project_id</em>&gt;.key</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="bu">cd</span> raw</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># fam</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="ex">../resources/ukgene</span> cal -c1 -m -ak<span class="op">&lt;</span>project_id<span class="op">&gt;</span>.key</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># sample</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="ex">../resources/ukgene</span> imp c1 -m -ak<span class="op">&lt;</span>project_id<span class="op">&gt;</span>.key</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># relatedness</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="ex">../resources/ukgene</span> rel -ak<span class="op">&lt;</span>project_id<span class="op">&gt;</span>.key</a></code></pre></div>
<p><br></p>
</div>
<div id="munge-the-ukb-data" class="section level4">
<h4 class="hasAnchor">
<a href="#munge-the-ukb-data" class="anchor"></a>Munge the UKB data</h4>
<p>Process the encrypted UKB files into formats to be read by ukbkings and include symlinks to the shared UKB genotyped and imputed genetic data on Rosalind.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ex">./snake.py</span></a></code></pre></div>
<p>The munged phenotype data are stored in phenotypes/, the genetic symlinks in genotyped/ and imputed/, and output information is written to log/ (<strong>Figure 2</strong>). For a dry run, in which no files are edited/ written to disk, only details of what would be munged is printed to standard output, use <code>./snake.py -n</code></p>
<p><br></p>
<p style="font-family:menlo; color:white; font-size:85%">
<span style="color:dodgerblue;">/scratch/datasets/ukbiobank/</span><br>
||– <span style="color:dodgerblue">ukb&lt;<em>project_id</em>&gt;_&lt;<em>owner_name</em>&gt;/</span><br>
||– ||– <span style="color:dimgrey">...</span><br>
||– ||– <span style="color:dodgerblue">phenotypes/</span><br>
||– ||– ||– <span style="color:dimgrey">ukb&lt;dataset_id&gt;.csv</span><br>
||– ||– ||– <span style="color:dimgrey">ukb&lt;dataset_id&gt;.html</span><br>
||– ||– ||– <span style="color:dimgrey">ukb&lt;dataset_id&gt;_field_finder.text</span><br>
||– ||– <span style="color:dodgerblue">genotyped/</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb&lt;project_id&gt;.bed</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb&lt;project_id&gt;.bim</span><br>
||– ||– <span style="color:dodgerblue">imputed/</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb_sqc.txt</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb_sqc_fields.txt</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb_imp_chr*.bgen</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb_imp_chr*.bgen.bgi</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb_mfi_chr*.txt</span>
</p>
<p><strong>Figure 2</strong> Phenotype data and genetic data symlinks</p>
<p><br></p>
</div>
<div id="add-symlinks-to-sample-information-and-relatedness-files" class="section level4">
<h4 class="hasAnchor">
<a href="#add-symlinks-to-sample-information-and-relatedness-files" class="anchor"></a>Add symlinks to sample information and relatedness files</h4>
<p>Sample information files (.fam and .sample) and the relatedness file (<em>rel</em>.dat/.txt) should be in raw/. Create symlinks to these project-specific files in genotyped/ and imputed/ (<strong>Figure 3</strong>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ex">./link.py</span> -f <span class="op">&lt;</span>path_to_fam_file<span class="op">&gt;</span> -s <span class="op">&lt;</span>path_to_sample_file<span class="op">&gt;</span> -r <span class="op">&lt;</span>path_to_relatedness_file<span class="op">&gt;</span></a></code></pre></div>
<p>You can link one or more of these files (they do not all need to be passed to the program).</p>
<p><br></p>
<p style="font-family:menlo; color:white; font-size:85%">
<span style="color:dodgerblue;">/scratch/datasets/ukbiobank/</span><br>
||– <span style="color:dodgerblue">ukb&lt;<em>project_id</em>&gt;_&lt;<em>owner_name</em>&gt;/</span><br>
||– ||– <span style="color:dimgrey">...</span><br>
||– ||– <span style="color:dodgerblue">genotyped/</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb&lt;project_id&gt;.fam</span><br>
||– ||– <span style="color:dodgerblue">imputed/</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb&lt;project_id&gt;.sample</span><br>
||– ||– ||– <span style="color:mediumturquoise">ukb&lt;project_id&gt;.rel</span>
</p>
<p><strong>Figure 3</strong> Project-specific sample information and relatedness symlinks</p>
<p><br></p>
<p><strong>UKB genetic data resources:</strong></p>
<ul>
<li><a href="https://biobank.ctsu.ox.ac.uk/crystal/crystal/docs/ukbgene_instruct.html#aut">Accessing Genetic Data within UK Biobank</a></li>
<li><a href="http://biobank.ndph.ox.ac.uk/showcase/refer.cgi?id=531">Resource 531: Description of genetic data types</a></li>
<li><a href="https://biobank.ctsu.ox.ac.uk/crystal/refer.cgi?id=664">Resource 664: Instructions for downloading genetic data using ukbgene</a></li>
<li><a href="http://biobank.ndph.ox.ac.uk/showcase/refer.cgi?id=667">Resource 667: UK Biobank Keyfile</a></li>
</ul>
<p><br></p>
</div>
<div id="access-the-data-with-ukbkings" class="section level4">
<h4 class="hasAnchor">
<a href="#access-the-data-with-ukbkings" class="anchor"></a>Access the data with ukbkings</h4>
<p>The data should now be available from anywhere on Rosalind through the <a href="https://kenhanscombe.github.io/ukbkings">ukbkings</a> R package. Read <a href="https://kenhanscombe.github.io/ukbkings/articles/kcl-ukb-access.html">Access UKB data on Rosalind</a> for a detailed description of usage. The same usage documentation is included in a package vignette. In R</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"kenhanscombe/ukbkings"</span>, <span class="kw">dependencies</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">force</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span>(<span class="st">"Access UKB data on Rosalind"</span>)</pre></body></html></div>
<p><br></p>
<hr>
<p><br></p>
</div>
<div id="additional-withdrawals" class="section level4">
<h4 class="hasAnchor">
<a href="#additional-withdrawals" class="anchor"></a>Additional withdrawals</h4>
<p>Each time an updated set of participant withdrawals is received, replace the w&lt;<em>project-id</em>&gt;_&lt;<em>yyyymmdd</em>&gt;.csv file in raw/ with the new file. To exclude the latest withdrawals you have to generate your dataset with ukbkings again. Be aware that if any researcher on your project does run the tool again (to grab some other data say), this would apply the latest set of withdrawals.</p>
<p><br></p>
</div>
<div id="updates-to-phenotype-data" class="section level4">
<h4 class="hasAnchor">
<a href="#updates-to-phenotype-data" class="anchor"></a>Updates to phenotype data</h4>
<p>If you receive any new data you would like to incorporate, place the new .enc and .key files (prepared as described in <a href="#include-project-data">Include project data</a>) into raw/ and re-run the data munging step (described in <a href="#munge-the-ukb-data">Munge the UKB data</a>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ken Hanscombe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
