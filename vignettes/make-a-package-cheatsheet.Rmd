---
title: "Make an R package tl;dr"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```


The definitive guide to building an R package is [R Packages: organize, test, document and share your code](https://r-pkgs.org/). Everything below is from this book, and the linked RStudio Community threads.

- A Package Development Cheat Sheet can be found about half way down [this page](https://rstudio.com/resources/cheatsheets/).

<br>

Below includes use of new packages `usethis` and `pkgdown`.

<br>

**Setup**

Install `usethis`, `devtools`, `testthat`, `pkgdown`. `usethis` helpfully creates necessary infrastructure (files and folders) and updates metadata (DESCRIPTION, .Rbuildignore, etc.).

```{r}
usethis::create_package("<path_to_new_or_existing_directory>")
usethis::use_readme_md()
```

<br>

Add optional license and lifecycle badge to indicate package development stage ("Experimental", "Maturing", "Stable", "Retired", "Archived", "Dormant", "Questioning").

```{r}
usethis::use_mit_license(name = "<your_name>")
usethis::use_lifecycle_badge("<development_stage>")
```

For adding other badges see `usethis::use_badge`

- See also [Tidyverse: Lifecycle badges](https://www.tidyverse.org/lifecycle/)

<br>

Add version control.

```{r}
usethis::use_git()
usethis::use_github()
```

<br>


**Testing**

Add unit testing and create a first test file. `use_test`

```{r}
usethis::use_testthat()
usethis::use_test("<test_file_name>")
```

**Workflow:**

1.	Modify your code or tests.
2.	Test your package with Ctrl/Cmd + Shift + T or `devtools::test()`.
3.	Repeat until all tests pass.

<br>


## Add example (or test data)

```{r}
usethis::use_data_raw()
```

<br>


**Documentation**

```{r}
usethis::use_package()
devtools::document()
```

**Workflow:**

1.	Add roxygen comments to your .R files.
2.	Run devtools::document() (or press Ctrl/Cmd + Shift + D in RStudio) to convert roxygen comments to .Rd files. (devtools::document() calls roxygen2::roxygenise() to do the hard work.)
3.	Preview documentation with ?.
4.	Rinse and repeat until the documentation looks the way you want.

Add package documentation to file <package-name>.R

```{r}
#' foo: A package for computating the notorious bar statistic.
#'
#' The foo package provides three categories of important functions:
#' foo, bar and baz.
#' 
#' @section Foo functions:
#' The foo functions ...
#'
#' @docType package
#' @name foo
NULL
```

<br>


**Vignettes**

[RStudio Community: R package - vignettes](https://community.rstudio.com/t/r-package-vignettes/26673)

<br>


**Build/check**

`devtools::check()`    document and check package can be built

<br>

Add global variables if needed, e.g., where unquoted variables used with non-standard evaluation.

```{r}
utils::globalVariables(c("<varible_1>", "<variable_2>"))
```

<br>


**Webpage**

```{r}
usethis::use_pkgdown()
```

<br>


**Keyboard shortcuts**

- quick reference   ALT_SHIFT+K
- format            CMD+SHIFT+A
- indent			      CMD+I
- roxygen skeleton  CMD+SHIFT+ALT+R
